#!/usr/bin/env node
/*jshint shelljs:true */

"use strict";

<<<<<<< HEAD
var path       = require("path");
var build      = require("../scripts/build");
require("shelljs/make");

var distDir    = path.join(__dirname, "../dist");

if (!test("-e", distDir))
  mkdir(distDir);

build("web", function(err, version, src) {
  if (err) {
    console.error(err);
    process.exit(1);
  }

  src.to(distDir + "/jshint.js");
  console.log("Built: " + version + " (web)");
});

build("rhino", function(err, version, src) {
  var dest;

  if (err) {
    console.error(err);
    process.exit(1);
  }

  dest  = distDir + "/jshint-rhino.js";
  chmod("+x", dest);

  src.to(dest);
  console.log("Built: " + version + " (Rhino)");
=======
var browserify = require("browserify");
var bundle     = browserify();
var path       = require("path");
var version    = require("../package.json").version;
require("shelljs/make");

var distDir    = path.join(__dirname, "../dist");
var srcDir     = path.join(__dirname, "../src");

if (!test("-e", distDir))
  mkdir(distDir);

bundle.require(srcDir + "/jshint.js", { expose: "jshint" });
bundle.bundle(function (err, src) {
  var web   = distDir + "/jshint.js";
  var rhino = distDir + "/jshint-rhino.js";

  [ "/*! " + version + " */",
    "var JSHINT;",
    "if (typeof window === 'undefined') window = {};",
    "(function () {",
      "var require;",
      src,
      "JSHINT = require('jshint').JSHINT;",
      "if (typeof exports === 'object' && exports) exports.JSHINT = JSHINT;",
    "}());"
  ].join("\n").to(web);

  ("#!/usr/bin/env rhino\nvar window = {};\n" + cat(web, srcDir + "/platforms/rhino.js")).to(rhino);
  chmod("+x", rhino);

  echo("Built: " + version);
>>>>>>> parent of cb9c2f6... [[CHORE]] ./bin/build now runs npm {prune, test, install} prior to building. Fixes gh-2305
});
